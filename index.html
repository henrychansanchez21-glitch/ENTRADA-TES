<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MultiShop | Cliente</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --white: #ffffff; }
        body { font-family: -apple-system, sans-serif; margin: 0; background: var(--bg); padding-bottom: 90px; }
        header { background: var(--primary); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; }
        .categorias { display: flex; overflow-x: auto; padding: 10px; gap: 10px; background: white; white-space: nowrap; }
        .btn-cat { background: #e2e8f0; border: none; padding: 10px 20px; border-radius: 20px; font-size: 14px; cursor: pointer; }
        .btn-cat.active { background: var(--primary); color: white; }
        .productos { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 12px; }
        .card { background: white; border-radius: 12px; padding: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); text-align: center; }
        .card img { width: 100%; height: 150px; object-fit: cover; border-radius: 10px; margin-bottom: 10px; }
        .card h3 { font-size: 14px; margin: 5px 0; color: #333; height: 35px; overflow: hidden; }
        .card p { color: var(--primary); font-weight: bold; margin-bottom: 10px; }
        .btn-add { background: #22c55e; color: white; border: none; width: 100%; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .carrito-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px 20px; box-shadow: 0 -3px 15px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 200; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 25px; border-radius: 20px; width: 85%; max-width: 400px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
    </style>
</head>
<body>

    <header><h1>MultiShop ðŸ›’</h1></header>

    <div class="categorias" id="cats">
        <button class="btn-cat active" onclick="filtrar('Todos')">Todos</button>
        <button class="btn-cat" onclick="filtrar('Ropa')">Ropa</button>
        <button class="btn-cat" onclick="filtrar('Electro')">Electro</button>
        <button class="btn-cat" onclick="filtrar('Juguetes')">Juguetes</button>
        <button class="btn-cat" onclick="filtrar('Accesorios')">Accesorios</button>
    </div>

    <div class="productos" id="lista-prod"></div>

    <div class="carrito-bar">
        <div>Total: <strong style="font-size: 1.2rem;">$<span id="total-txt">0</span></strong></div>
        <button onclick="abrirCheckout()" style="background:var(--primary); color:white; border:none; padding:12px 25px; border-radius:10px; font-weight:bold; cursor:pointer;">Pagar</button>
    </div>

    <div id="modal">
        <div class="modal-content">
            <h3>Finalizar Pedido</h3>
            <input type="text" id="nombre-cli" placeholder="Nombre completo">
            <input type="tel" id="tel-cli" placeholder="WhatsApp">
            <button onclick="confirmar()" style="width:100%; padding:14px; background:#22c55e; color:white; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">Confirmar</button>
            <button onclick="cerrar()" style="width:100%; padding:10px; background:none; border:none; color:#666; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC0GygFtlHwqKH-GnKfCPHsNvJq01xG4Qk",
            authDomain: "shop-88915.firebaseapp.com",
            databaseURL: "https://shop-88915-default-rtdb.firebaseio.com",
            projectId: "shop-88915",
            storageBucket: "shop-88915.firebasestorage.app",
            messagingSenderId: "408775073232",
            appId: "1:408775073232:web:a328afd7103299e9f2add5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let todosLosProductos = [];
        let carrito = [];

        db.ref('productos').on('value', (snapshot) => {
            const data = snapshot.val();
            todosLosProductos = [];
            for(let id in data) todosLosProductos.push({id, ...data[id]});
            render();
        });

        function render(filtro = 'Todos') {
            const container = document.getElementById('lista-prod');
            container.innerHTML = '';
            const filtrados = filtro === 'Todos' ? todosLosProductos : todosLosProductos.filter(p => p.cat === filtro);
            filtrados.forEach(p => {
                container.innerHTML += `
                    <div class="card">
                        <img src="${p.foto}" alt="${p.nom}" onerror="this.src='https://via.placeholder.com/150'">
                        <h3>${p.nom}</h3>
                        <p>$${p.pre}</p>
                        <button class="btn-add" onclick="add('${p.id}')">AÃ±adir</button>
                    </div>`;
            });
        }

        function add(id) {
            const p = todosLosProductos.find(x => x.id === id);
            carrito.push(p);
            document.getElementById('total-txt').innerText = carrito.reduce((s, x) => s + x.pre, 0);
        }

        function filtrar(c) {
            document.querySelectorAll('.btn-cat').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            render(c);
        }

        function abrirCheckout() { if(carrito.length > 0) document.getElementById('modal').style.display = 'flex'; }
        function cerrar() { document.getElementById('modal').style.display = 'none'; }

        function confirmar() {
            const nom = document.getElementById('nombre-cli').value;
            const tel = document.getElementById('tel-cli').value;
            if(!nom || !tel) return alert("Completa tus datos");

            const total = carrito.reduce((s, x) => s + x.pre, 0);
            const itemsTxt = carrito.map(i => i.nom).join(', ');

            db.ref('pedidos').push({ cliente: nom, tel: tel, items: itemsTxt, total: total, fecha: new Date().toLocaleString() })
            .then(() => {
                const numeroTienda = "50212345678"; // <--- TU NUMERO
                const msg = `*Pedido Nuevo*\n*Cliente:* ${nom}\n*Pedido:* ${itemsTxt}\n*Total:* $${total}`;
                window.open(`https://wa.me/${numeroTienda}?text=${encodeURIComponent(msg)}`, '_blank');
                location.reload();
            });
        }
    </script>
</body>
</html>
